function getVersion(){return"2.1.1"}function getVersionType(){return"pageAction"}var ctrlState="false";var shiftState="false";var itemSelectedColor="#ffcbd3";var selectedItem;var prh;if(window.navigator.platform=="Win32"){var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16300412-1"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://ssl.google-analytics.com/ga.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})()}function popup_scrollbar_fix(){var b=$(document.body).getSize().y;var a=$(document.body).getScrollSize().y;if(a>b){$("popup").setStyle("margin-right","24px")}else{$("popup").setStyle("margin-right","5px")}}function getUrlVars(){var e=[],c;var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var b=0;b<a.length;b++){c=a[b].split("=");e.push(c[0]);e[c[0]]=c[1]}return e}function isLeapYear(){var a=$("date-select-year").getSelected().get("value")*1;return(a%400==0||(a%100!=0&&a%4==0))}function timeNow(b){var g=localStorage["rh-timeformat"];if(b==0){var e=new Date()}else{var e=new Date(b)}var a=e.getHours()*1;var c=e.getMinutes()*1;if(g=="12"){if(a>11){var h=" "+returnLang("PM")}else{var h=" "+returnLang("AM")}if(a==0){a=12}if(a>12){a=a-12}}else{if(g=="24"){var h=""}}if(a<10){a="0"+a}if(c<10){c="0"+c}return a+":"+c+h}function formatDate(h){h=h*1;var e=localStorage["rh-date"];var b=new Date(h);var a=b.getDate()+"";var g=(b.getMonth()+1)+"";var c=b.getFullYear()+"";if(a.length==1){a="0"+a}if(g.length==1){g="0"+g}e=e.replace("dd",a);e=e.replace("mm",g);e=e.replace("yyyy",c);return e}function truncate(c,b,a){if(c.length>a){return c.substring(b,a)+"..."}else{return c.substring(b,a)}}function chromeURL(a){chrome.tabs.create({url:a,selected:true})}function echoLang(a){document.write(chrome.i18n.getMessage(a))}function returnLang(a){return chrome.i18n.getMessage(a)}Clipboard={};Clipboard.utilities={};Clipboard.utilities.createTextArea=function(b){var a=document.createElement("textarea");a.style.position="absolute";a.style.left="-100%";if(b!=null){a.value=b}document.body.appendChild(a);return a};Clipboard.copy=function(b){if(b==null){return}var a=Clipboard.utilities.createTextArea(b);a.select();document.execCommand("Copy");document.body.removeChild(a);return false};function leftClick(b){new Event(event).stop();var a=localStorage["rh-click"];var c=ctrlState;if(c=="true"||event.button==1){chrome.tabs.create({url:b,selected:false})}else{if(a=="current"){chrome.tabs.getSelected(null,function(e){chrome.tabs.update(e.id,{url:b},function(){window.close()})})}else{if(a=="newtab"){chrome.tabs.create({url:b,selected:true});window.close()}else{if(a=="newbgtab"){chrome.tabs.create({url:b,selected:false})}}}}}function rightClick(a){Clipboard.copy(a)}function loadOptionsLang(){$("save").set("value",returnLang("saveOptions"));$$(".help-tip").each(function(a){a.set("title",returnLang(a.get("id")))});new Tips(".help-tip")}function loadOptions(){$("rhitemsno").set("value",localStorage["rh-itemsno"]);$("rctitemsno").set("value",localStorage["rct-itemsno"]);$("mvitemsno").set("value",localStorage["mv-itemsno"]);$("rbitemsno").set("value",localStorage["rb-itemsno"]);var a=localStorage["rh-list-order"].split(",");for(var b in a){if(a[b]=="rh-order"){new Element("li",{id:a[b],html:returnLang("recentHistory")}).inject("rhlistorder")}else{if(a[b]=="rct-order"){new Element("li",{id:a[b],html:returnLang("recentlyClosedTabs")}).inject("rhlistorder")}else{if(a[b]=="mv-order"){new Element("li",{id:a[b],html:returnLang("mostVisited")}).inject("rhlistorder")}else{if(a[b]=="rb-order"){new Element("li",{id:a[b],html:returnLang("recentBookmarks")}).inject("rhlistorder")}else{if(a[b]=="pinned-order"){new Element("li",{id:a[b],html:returnLang("pinned")}).inject("rhlistorder")}}}}}}var c=new Sortables("#rhlistorder",{onStart:function(e){$$("#rhlistorder li").each(function(g){if(g!==e){g.setStyle("opacity",0.4)}})},onComplete:function(e){$$("#rhlistorder li").setStyle("opacity",1)}});$$('#rhhistorypage option[value="'+localStorage["rh-historypage"]+'"]').set("selected","selected");$$('#rhdate option[value="'+localStorage["rh-date"]+'"]').set("selected","selected");$$('#rhtime option[value="'+localStorage["rh-timeformat"]+'"]').set("selected","selected");$$('#rhsearch option[value="'+localStorage["rh-search"]+'"]').set("selected","selected");$$('#rhshare option[value="'+localStorage["rh-share"]+'"]').set("selected","selected");$$('#rhsshowurl option[value="'+localStorage["rhs-showurl"]+'"]').set("selected","selected");$$('#rhsshowsep option[value="'+localStorage["rhs-showsep"]+'"]').set("selected","selected");$$('#rhsshowext option[value="'+localStorage["rhs-showext"]+'"]').set("selected","selected");$$('#rhsshowbg option[value="'+localStorage["rhs-showbg"]+'"]').set("selected","selected");previewItem();$("rhsshowurl").addEvent("change",function(){previewItem()});$("rhsshowsep").addEvent("change",function(){previewItem()});$("rhsshowext").addEvent("change",function(){previewItem()});$$('#rhicontype input[value="'+localStorage["rh-icontype"]+'"]').setProperty("checked","checked");$("rhwidth").set("value",localStorage["rh-width"].toInt());$$('#rhtheme option[value="'+localStorage["rh-theme"]+'"]').set("selected","selected");mostVisitedBlocklist();filteredDomainsList();$$('#rhclick option[value="'+localStorage["rh-click"]+'"]').set("selected","selected")}function loadSlider(g,c,b,e){$(g).setStyle("text-align","right");var a=new Slider(g+"-slider",g+"-slider-handle",{range:[c,b],snap:true,initialStep:localStorage[e].toInt(),onChange:function(h){$(g).set("value",h)}});$(g).addEvent("blur",function(){var h=$(g).get("value")*1;if(h>=c&&h<=b){a.set(h)}else{$(g).set("value",c);a.set(c);alert(c+"-"+b)}});$(g).addEvent("keydown",function(h){if(h.event.keyCode==40&&($(g).get("value")*1)>c){$(g).set("value",($(g).get("value")*1)-1);a.set($(g).get("value"))}});$(g).addEvent("keydown",function(h){if(h.event.keyCode==38&&($(g).get("value")*1)<b){$(g).set("value",($(g).get("value")*1)+1);a.set($(g).get("value"))}})}function saveOptions(){var h={};var g=$$("#rhlistorder li");var e=$$("#mvlist tr td:first-child");var j=$$("#flist tr td:first-child");var b="";var a="";$("save").set("value",returnLang("saving"));if(e.length>0){for(m=0;m<e.length;m++){b+=e[m].get("text")+"|"}}else{b="false"}if(j.length>0){for(f=0;f<j.length;f++){a+=j[f].get("text")+"|"}}else{a="false"}h["rh-itemsno"]=$("rhitemsno").get("value");h["rct-itemsno"]=$("rctitemsno").get("value");h["rb-itemsno"]=$("rbitemsno").get("value");h["mv-itemsno"]=$("mvitemsno").get("value");h["rh-list-order"]=g[0].get("id")+","+g[1].get("id")+","+g[2].get("id")+","+g[3].get("id")+","+g[4].get("id");h["rh-historypage"]=$("rhhistorypage").getSelected().get("value");h["rh-date"]=$("rhdate").getSelected().get("value");h["rh-timeformat"]=$("rhtime").getSelected().get("value");h["rh-search"]=$("rhsearch").getSelected().get("value");h["rh-share"]=$("rhshare").getSelected().get("value");h["rhs-showurl"]=$("rhsshowurl").getSelected().get("value");h["rhs-showsep"]=$("rhsshowsep").getSelected().get("value");h["rhs-showext"]=$("rhsshowext").getSelected().get("value");h["rhs-showbg"]=$("rhsshowbg").getSelected().get("value");h["rh-icontype"]=$$("#rhicontype input:checked")[0].get("value");h["rh-width"]=$("rhwidth").get("value")+"px";h["rh-theme"]=$("rhtheme").getSelected().get("value");h["mv-blocklist"]=b;h["rh-filtered"]=a;h["rh-click"]=$("rhclick").getSelected().get("value");for(var c in h){localStorage[c]=h[c];console.log(c+"="+h[c])}if(getVersionType()=="pageAction"){chrome.windows.getAll({},function(l){for(var k in l){if(l[k].id!==undefined){chrome.tabs.getAllInWindow(l[k].id,function(o){for(var p in o){if(o[p].id!==undefined){chrome.pageAction.setIcon({tabId:o[p].id,path:"images/"+h["rh-icontype"]+".png"})}}})}}})}else{if(getVersionType()=="browserAction"){chrome.browserAction.setIcon({path:"images/"+h["rh-icontype"]+".png"})}}(function(){$("save").set("value",returnLang("saved"))}).delay(1500);(function(){$("save").set("value",returnLang("saveOptions"))}).delay(3000)}function previewItem(){var c=$("rhsshowurl").getSelected().get("value");var b=$("rhsshowsep").getSelected().get("value");var a=$("rhsshowext").getSelected().get("value");if(c=="yes"){$("rhitemstyle-url").setStyle("display","inline")}else{$("rhitemstyle-url").setStyle("display","none")}if(b=="yes"){$("rhitemstyle").setStyle("border-bottom","1px solid #ccc")}else{$("rhitemstyle").setStyle("border-bottom","0 none")}if(a=="yes"){$("rhitemstyle-info").setStyle("display","inline")}else{$("rhitemstyle-info").setStyle("display","none")}if(a=="yes"&&c=="yes"){$("rhitemstyle-sep").setStyle("display","inline")}else{$("rhitemstyle-sep").setStyle("display","none")}}function mostVisitedBlocklist(){var a=localStorage["mv-blocklist"];if(a.length>0&&a!=="false"){a=a.split("|");if(a.length>0){for(i=0;i<a.length;i++){if(a[i]!==undefined&&a[i]!==""){new Element("tr",{html:'<td><div title="'+a[i]+'">'+a[i]+'</div></td><td style="width:20px;"><a href="javascript:void(0);" onclick="this.getParent(\'tr\').destroy()"><img alt="Restore" src="images/remove.png"></a></td>',"class":"op-item"}).inject("mvlist-table")}}}}}function filteredDomainsList(){var a=localStorage["rh-filtered"];if(a.length>0&&a!=="false"){a=a.split("|");if(a.length>0){for(i=0;i<a.length;i++){if(a[i]!==undefined&&a[i]!==""){new Element("tr",{html:'<td><div title="'+a[i]+'">'+a[i]+'</div></td><td style="width:20px;"><a href="javascript:void(0);" onclick="this.getParent(\'tr\').destroy()"><img alt="Restore" src="images/remove.png"></a></td>',"class":"op-item"}).inject("flist-table")}}}}}function addFilteredItem(){var a=$("flist-add-i").get("value").replace(" ","");var b="test";if(a.length>0){$$("#flist-table tr td:first-child").each(function(c){if(c.get("text")==a){b=c.get("text")}});if(b=="test"){new Element("tr",{html:'<td><div title="'+a+'">'+a+'</div></td><td style="width:20px;"><a href="javascript:void(0);" onclick="this.getParent(\'tr\').destroy()"><img alt="Restore" src="images/remove.png"></a></td>',"class":"op-item"}).inject("flist-table");$("flist-add-i").set("value","")}}}function twitterUpdates(b){if(b.length>0){$("twitter-insert").set("text","");for(i=0;i<b.length;i++){var c=new Date(b[i].created_at);var a="Tweeted on "+c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear();new Element("div",{html:'<div class="tweet-text">"'+b[i].text+'"</div><div class="tweet-date">'+a+"</div>","class":"tweet"}).inject("twitter-insert")}}}function popupSearch(a){if(a!==""&&a!==undefined){chrome.history.search({text:a,maxResults:30},function(c){if(c.length>0){$("popup-search-insert").set("text","");for(i=0;i<=c.length;i++){if(c[i]!==undefined){var h=c[i].title;var b=c[i].url;var g=c[i].visitCount;var e="chrome://favicon/"+c[i].url;if(h!==""){formatItem({type:"rh",title:h,url:b,favicon:e,visits:g}).inject("popup-search-insert")}}}if(localStorage["rhs-showbg"]=="yes"){isBookmarked("#popup-search-insert ");isPinned("#popup-search-insert ")}}else{$("popup-search-insert").set("html",'<div class="no-results"><span>'+returnLang("noResults")+"</span></div>")}})}}function isBookmarked(a){$$(a).each(function(b){chrome.bookmarks.search(b.get("href"),function(e){if(e.length>0){for(var c in e){if(e[c].url==b.get("href")){if(a=="#rh-views .item .link"){if(b.getParent("div.item").getElement("span.bookmark")){b.getParent("div.item").getElement("span.bookmark").setStyle("background-image",'url("images/star.png")')}}else{if(b.getStyle("background-color")!=="#ffffbd"){b.setStyle("background-color","#ffffbd")}}}}}})})}function isPinned(a){$$(a).each(function(c){var e=JSON.decode(localStorage["rh-pinned"]);if(e.length>0){for(var b in e){if(e[b]!==undefined){if(e[b].url==c.get("href")){if(a=="#rh-views .item .link"){if(c.getParent("div.item").getElement("span.pin")){c.getParent("div.item").getElement("span.pin").setStyle("background-image",'url("images/pin.png")')}}else{if(c.getStyle("background-color")!=="#f0fff1"){c.setStyle("background-color","#f0fff1")}}}}}}})}function uiEditItems(a){if($$("#"+a+"-inject .edit-items-ui").length>0){if($$("#"+a+"-inject .edit-items-ui")[0].getStyle("display")=="none"){$$("#"+a+"-inject .edit-items-ui").setStyle("display","inline")}else{if($$("#"+a+"-inject .edit-items-ui")[0].getStyle("display")=="inline"){$$("#"+a+"-inject .edit-items-ui").setStyle("display","none")}}}}function alertUser(b,a){if(a=="close"){$("alert-holder").setStyle("display","none");$("alert-yes").destroy();$("alert-no").destroy()}else{if(a=="open"){$("alert-holder").setStyle("display","block");$("alert-text").set("text",b);new Element("input",{type:"button",id:"alert-yes",value:returnLang("yes")}).inject("alert");new Element("input",{type:"button",id:"alert-no",value:returnLang("no")}).inject("alert")}}}function uiPinItem(b,a){alertUser(returnLang("ui1"),"open");$("alert-no").addEvent("click",function(){alertUser("","close")});$("alert-yes").addEvent("click",function(){var c=b.getParent("a").get("href");var j=b.getParent("a").getChildren("span.title").get("text")[0].trim();var e=b.getParent("a").getChildren("img")[0].get("src");var h=timeNow(0);var g=localStorage["rh-pinned"];if(g.indexOf('"'+c+'"')==-1){if(g=="false"){localStorage["rh-pinned"]=JSON.encode([{url:c,title:j,favicon:e,time:h}]);$("pi-inject").setStyle("display","inline");if(a=="rh"){$$("#rh-inject .item").destroy();recentHistory()}else{if(a=="rct"){$$("#rct-inject .item").destroy();recentlyClosedTabs()}else{if(a=="rb"){$$("#rb-inject .item").destroy();recentBookmarks()}else{if(a=="mv"){$$("#mv-inject .item").destroy();mostVisited()}}}}pinned();alertUser("","close")}else{g=JSON.decode(g);g.unshift({url:c,title:j,favicon:e,time:h});localStorage["rh-pinned"]=JSON.encode(g);if(a=="rh"){$$("#rh-inject .item").destroy();recentHistory()}else{if(a=="rct"){$$("#rct-inject .item").destroy();recentlyClosedTabs()}else{if(a=="rb"){$$("#rb-inject .item").destroy();recentBookmarks()}else{if(a=="mv"){$$("#mv-inject .item").destroy();mostVisited()}}}}$$("#pi-inject .item").destroy();pinned();alertUser("","close")}}})}function uiDeleteItem(b,a){if(a=="rh"){alertUser(returnLang("ui2"),"open")}else{if(a=="rct"){alertUser(returnLang("ui3"),"open")}else{if(a=="rb"){alertUser(returnLang("ui4"),"open")}else{if(a=="mv"){alertUser(returnLang("ui5"),"open")}else{if(a=="pi"){alertUser(returnLang("ui6"),"open")}}}}}$("alert-yes").addEvent("click",function(){var e=b.getParent("a").get("href");if(a=="rh"){chrome.history.deleteUrl({url:e});$$("#rh-inject .item").destroy();recentHistory();alertUser("","close")}else{if(a=="rct"){var k=chrome.extension.getBackgroundPage().closedTabs;for(var g in k){if(k[g]!==undefined&&k[g].url==e){k.splice(g,1);$$("#rct-inject .item").destroy();recentlyClosedTabs();if($$("#rct-inject .item").length==0){$("rct-inject").setStyle("display","none")}alertUser("","close");break}}}else{if(a=="rb"){chrome.bookmarks.search(e,function(n){if(n.length>0){for(var l in n){if(n[l].url==e){chrome.bookmarks.remove(n[l].id,function(){$$("#rb-inject .item").destroy();recentBookmarks();$$("#popup-insert .item").setStyle("background-color","transparent");isBookmarked("#rh-inject .item");isPinned("#rh-inject .item");isBookmarked("#rct-inject .item");isPinned("#rct-inject .item");if($$("#rb-inject .item").length==0){$("rb-inject").setStyle("display","none")}alertUser("","close")})}}}})}else{if(a=="mv"){var c=localStorage["mv-blocklist"];if(c=="false"){localStorage["mv-blocklist"]=e+"|"}else{localStorage["mv-blocklist"]=localStorage["mv-blocklist"]+e+"|"}$$("#mv-inject .item").destroy();mostVisited();alertUser("","close")}else{if(a=="pi"){var j=JSON.decode(localStorage["rh-pinned"]);var h=j.length;if(h>0){for(var g in j){if(j[g]!==undefined){if(j[g].url==e){j.splice(g,1);if(h==1){localStorage["rh-pinned"]="false"}else{localStorage["rh-pinned"]=JSON.encode(j)}$$("#pi-inject .item").destroy();pinned();if($$("#pi-inject .item").length==0){$("pi-inject").setStyle("display","none")}$$("#popup-insert .item").setStyle("background-color","transparent");isBookmarked("#rh-inject .item");isPinned("#rh-inject .item");isBookmarked("#rct-inject .item");isPinned("#rct-inject .item");alertUser("","close")}}}}}}}}}});$("alert-no").addEvent("click",function(){alertUser("","close")})}function formatItem(u){var s="";var q={};var k=localStorage["rhs-showurl"];var o=localStorage["rhs-showext"];var a=localStorage["rhs-showbg"];var c=u.url;var b=u.type;var v=u.title.replace(/\"/g,"&#34;");var t=u.favicon;var g=u.time;if(u.visits!==undefined){var n=u.visits}else{var n=""}if(k=="yes"||o=="yes"){var r='style="margin-top:-3px;"'}else{var r=""}if(o=="no"){var j='style="display:none;"'}else{if(b=="rh"||b=="mv"){var j=""}else{var j='style="display:none;"'}}if(k=="no"){var h='style="display:none;"'}else{var h=""}if(localStorage["rhs-showsep"]=="yes"){q["border-bottom"]="1px solid #ccc"}if(o=="yes"&&k=="yes"){var e=" | "}else{var e=""}var l="";if(v==c){l=v}else{l=v+" | "+c}if(g!==undefined){l=l+" | "+g}if(b!=="pi"){var p='<span class="ui-pin" onclick="uiPinItem(this, \''+b+'\')">&nbsp;</span><span class="ui-delete" onclick="uiDeleteItem(this, \''+b+"')\">&nbsp;</span>"}else{var p='<span class="ui-delete" onclick="uiDeleteItem(this, \''+b+"')\">&nbsp;</span>"}if(localStorage["rh-share"]=="yes"){p=p+'<span class="ui-share" onclick="window.open(\'share.html?'+Hash.toQueryString({url:c,title:v.replace(/\'/g,"")})+"', '"+returnLang("option21")+"', 'width=600,height=350')\">&nbsp;</span>"}s+='<img onerror="this.setProperty(\'src\',\'images/blank.png\')" class="favicon" alt="Favicon" src="'+t+'">';s+='<span class="title" title="'+l+"\"><span class=\"edit-items-ui\" onmouseover=\"this.getParent('a').set('onclick', 'return false'); this.getParent('span').set('title', '')\" onmouseout=\"this.getParent('a').set('onclick', 'leftClick(\\'"+c+"\\')'); this.getParent('span').set('title', '"+l.replace(/\'/g,"\\'")+"')\">"+p+"</span>"+v+"</span>";s+="<span "+r+' class="extra-url"><span '+j+' class="extra">'+returnLang("visits")+": "+n+e+"</span><span "+h+' class="url">'+c.replace(/^(.*?)\:\/\//,"").replace(/\/$/,"")+"</span></span>";return new Element("a",{onclick:"leftClick('"+c+"')",oncontextmenu:"rightClick('"+c+"')","class":"item",target:"_blank",styles:q,href:c,html:s})}function recentHistory(){var g=0;var b="";var a=localStorage["rh-itemsno"]*1;var e=a;var c=localStorage["rh-filtered"];a=a*4;if(a>0){chrome.history.search({text:"",maxResults:a,startTime:(new Date()).getTime()-(28*24*3600*1000),endTime:(new Date()).getTime()},function(j){if(j.length>0){for(i=0;i<=j.length;i++){if(g==e){break}if(j[i]!==undefined){var o=j[i].title;var h=j[i].url;var n=j[i].visitCount;var k="chrome://favicon/"+j[i].url;var p=(/^(file|chrome|chrome-extension|chrome-devtools)\:\/\//).test(h);if(o==""){o=h}if(c=="false"){if(!p){formatItem({type:"rh",title:o,url:h,favicon:k,visits:n,time:timeNow(j[i].lastVisitTime)}).inject("rh-inject","bottom");g++}}else{var l=new URI(h);if(c.indexOf(l.get("host")+"|")==-1){if(!p){formatItem({type:"rh",title:o,url:h,favicon:k,visits:j[i].visitCount,time:timeNow(j[i].lastVisitTime)}).inject("rh-inject","bottom");g++}}}}}if(localStorage["rhs-showbg"]=="yes"){isBookmarked("#rh-inject .item");isPinned("#rh-inject .item")}}})}}function recentlyClosedTabs(){var c=chrome.extension.getBackgroundPage().closedTabs;var b=localStorage["rct-itemsno"]*1;var j=localStorage["rh-filtered"];var l=0;if(b>0){if(c.length>0){for(i=0;i<99;i++){if(b==l){break}if(c[i]!==undefined){var k=c[i].title;var a=c[i].url;var g=c[i].time;var h="chrome://favicon/"+c[i].url;if(k==""){k=a}if(k!==undefined){if(!(/^(file|chrome|chrome-extension|chrome-devtools)\:\/\//).test(a)){if(c[(i-1)]==undefined){var e=new URI(a);if(j.indexOf(e.get("host")+"|")==-1){formatItem({type:"rct",title:k,url:a,favicon:h,time:g}).inject("rct-inject","bottom");l++}}else{if(c[(i-1)].url!==a){var e=new URI(a);if(j.indexOf(e.get("host")+"|")==-1){formatItem({type:"rct",title:k,url:a,favicon:h,time:g}).inject("rct-inject","bottom");l++}}}}}}}if($$("#rct-inject .item").length==0){$("rct-inject").setStyle("display","none")}if(localStorage["rhs-showbg"]=="yes"){isBookmarked("#rct-inject .item");isPinned("#rct-inject .item")}}}}function mostVisited(){var e=localStorage["mv-cache"];if(e!=="false"){var c=JSON.decode(e);var g=localStorage["mv-itemsno"]*1;var a=localStorage["mv-blocklist"];var b=0;for(i=0;i<45;i++){if(b==g){break}if(c[i].title!==undefined){if(a.indexOf(c[i].url+"|")==-1){formatItem({type:"mv",url:c[i].url,favicon:c[i].favicon,title:c[i].title,visits:c[i].visitCount}).inject("mv-inject","bottom");b++}}}}}function recentBookmarks(){var a=localStorage["rb-itemsno"]*1;if(a>0){chrome.bookmarks.getRecent(a,function(g){if(g.length>0){for(i=0;i<=g.length;i++){if(g[i]!==undefined){var e=g[i].title;var b=g[i].url;var c="chrome://favicon/"+g[i].url;if(e==""){e=b}formatItem({type:"rb",url:b,title:e,favicon:c,time:formatDate(g[i].dateAdded)}).inject("rb-inject","bottom")}}}})}}function pinned(){var b=localStorage["rh-pinned"];if(b!=="false"){var a=JSON.decode(b);for(i=0;i<99;i++){if(a[i]!==undefined){formatItem({type:"pi",url:a[i].url,favicon:a[i].favicon,title:a[i].title,time:a[i].time}).inject("pi-inject","bottom")}}}}function alertUserHistory(a){if($("alert-holder").getStyle("display")=="block"){$("alert-holder").setStyle("display","none");$("alert-holder-loading").setStyle("margin-top","-15px");if(a){$("pacman-iframe").set("src","");$("pacman-iframe").setStyle("display","none")}}else{if($("alert-holder").getStyle("display")=="none"){$("alert-holder").setStyle("display","block");if(a){$("pacman-iframe").set("src","pacman/index.html");(function(){$("alert-holder-loading").setStyle("margin-top","36px");$("pacman-iframe").setStyle("display","block")}).delay(3000)}}}}function calendar(p,l){if(isLeapYear()){var c=[31,29,31,30,31,30,31,31,30,31,30,31]}else{var c=[31,28,31,30,31,30,31,31,30,31,30,31]}if(p=="current"){var n=new Date()}else{if("selected"){var k=c[($("date-select-month").getSelected().get("value")*1-1)];var o=($("date-select-day").getSelected().get("value")*1);if(k<o){var n=new Date(($("date-select-year").getSelected().get("value")*1),($("date-select-month").getSelected().get("value")*1-1),k,23,59,59,999)}else{var n=new Date(($("date-select-year").getSelected().get("value")*1),($("date-select-month").getSelected().get("value")*1-1),($("date-select-day").getSelected().get("value")*1),23,59,59,999)}}}if(l=="prev"){n.setDate(n.getDate()-1)}else{if(l=="next"){n.setDate(n.getDate()+1)}}$("date-select-day").set("html","");var q=new Date().getFullYear();var b=n.getMonth();var h=n.getDate();var g=[q,(q-1)];if(p=="current"){for(i=0;i<g.length;i++){if(i==0){new Element("option",{value:g[i],selected:"selected",text:g[i]}).inject("date-select-year")}else{new Element("option",{value:g[i],text:g[i]}).inject("date-select-year")}}}$$("#date-select-month option").each(function(e){if((b)+1==(e.get("value")*1)){e.set("selected","selected")}});for(i=0;i<=c.length;i++){if(b==i){for(ia=1;ia<=c[i];ia++){if(ia==h){ia=ia+"";if(ia.length==1){ia="0"+ia}new Element("option",{value:ia,selected:"selected",text:ia}).inject("date-select-day")}else{ia=ia+"";if(ia.length==1){ia="0"+ia}new Element("option",{value:ia,text:ia}).inject("date-select-day")}}}}var a=new Date(q,b,1,23,59,59,999).getDay();var j=new Date(q,b,c[b],23,59,59,999).getDay();$("calendar-days").set("text","");for(ii=0;ii<c[b];ii++){if(ii==0){for(d=0;d<a;d++){new Element("span",{html:"&nbsp;","class":"day"}).inject("calendar-days")}}if((ii+1)==h){new Element("a",{id:"selected",href:"javascript:void(0)",rel:(ii+1)+"|"+(b+1)+"|"+q,text:(ii+1),"class":"day",events:{click:function(){var e=this;$$("#date-select-day option").each(function(r){if(r.get("value").toInt()==e.get("text").toInt()){r.set("selected","selected")}else{r.set("selected","")}});$$("#calendar-days a#selected").removeProperty("id");e.set("id","selected");history("yes","")}}}).inject("calendar-days")}else{new Element("a",{href:"javascript:void(0)",text:(ii+1),"class":"day",events:{click:function(){var e=this;$$("#date-select-day option").each(function(r){if(r.get("value").toInt()==e.get("text").toInt()){r.set("selected","selected")}else{r.set("selected","")}});$$("#calendar-days a#selected").removeProperty("id");e.set("id","selected");history("yes","")}}}).inject("calendar-days")}if((ii+1)==c[b]){for(d=0;d<(6-j);d++){new Element("span",{html:"&nbsp;","class":"day"}).inject("calendar-days")}}}}function history(g,l){var n=$("rh-what").getSelected().get("value");var c=localStorage["rh-group"];var b=localStorage["rh-orderby"];var a=localStorage["rh-order"];var k={};var e=[];var t={};if(prh){clearInterval(prh)}if(g=="yes"||g=="current"){if(g=="yes"){var p=($("date-select-day").getSelected().get("value")*1);var x=($("date-select-month").getSelected().get("value")*1-1);var h=($("date-select-year").getSelected().get("value")*1);var v=new Date(h,x,p,23,59,59,999)}else{if(g=="current"){var s=new Date();var v=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)}}var u=v.getTime();k.startTime=(u-86400000);k.endTime=v.getTime();k.maxResults=999;k.text="";var o="rh-views-insert";$("rh-views-search-insert").setStyle("display","none");$("rh-views-insert").setStyle("display","block");$("rh-search").set("value","");$("delete-range-one").set("value",formatDate(u));$("delete-range-two").set("value",formatDate(u))}else{if(g=="search"){if(n=="current"){var p=($("date-select-day").getSelected().get("value")*1);var x=($("date-select-month").getSelected().get("value")*1-1);var h=($("date-select-year").getSelected().get("value")*1);var r=new Date(h,x,p,23,59,59,999);var u=r.getTime();var j=(u-86400000);k.startTime=j;k.endTime=r.getTime()}else{if(n=="all"){k.startTime=(new Date()).getTime()-(28*24*3600*1000);k.endTime=(new Date()).getTime()}else{if(n=="recent"){}}}k.text=l;k.maxResults=100;var o="rh-views-search-insert";$("rh-views-search-insert").setStyle("display","block");$("rh-views-insert").setStyle("display","none")}}$(o).set("text",returnLang("loading"));chrome.history.search(k,function(z){if(z.length>0){for(i=0;i<=z.length;i++){if(z[i]!==undefined&&(/^(http|https|ftp|ftps)\:\/\//).test(z[i].url)){var E=z[i].title;var q=z[i].url;var C=z[i].visitCount;var B="chrome://favicon/"+z[i].url;if(E==""){E=q}e.push({url:q,host:(new URI(q).get("host")),time:timeNow(z[i].lastVisitTime),date:formatDate(z[i].lastVisitTime),favicon:B,title:truncate(E,0,100),visits:C})}}if(e.length>0){if(o=="rh-views-insert"){var w=e.length;$("calendar-total-value").set("text",w);if(w==0||w<50){$$("#calendar a#selected").setStyle("background-color","#daf3cb")}else{if(w>49&&w<100){$$("#calendar a#selected").setStyle("background-color","#aade8a")}else{if(w>99&&w<150){$$("#calendar a#selected").setStyle("background-color","#6dc738");$$("#calendar a#selected").setStyle("color","#fff")}else{$$("#calendar a#selected").setStyle("background-color","#4e991f");$$("#calendar a#selected").setStyle("color","#fff")}}}}if(b=="title"){e.sort(function(G,F){if(c=="yes"){var I=G.host.replace("www.","");var H=F.host.replace("www.","")}else{if(c=="no"){var I=G.title;var H=F.title}}if(I<H){return -1}else{if(I>H){return 1}else{return 0}}})}if(a=="asc"){e.reverse()}$(o).set("text","");var y="#f1f1f1";var A="grey";var D={counter:0};if(c=="yes"){prh=(function(){var G=this;if(G.counter==e.length){clearInterval(prh)}else{if(e[G.counter]!==undefined){if(!$(o).getElement('div[rel="'+e[G.counter].host+'"]')){new Element("div",{title:e[G.counter].host,rel:A,styles:{"background-color":y},"class":"item-holder group-title",html:'<a href="javascript:void(0)" class="group-title-toggle" onclick="toggleGroup(\''+e[G.counter].host+'\')" rel="'+e[G.counter].host+'"></a><input type="checkbox" class="group-title-checkbox" onclick="getMoreItems(this)" value="'+e[G.counter].host+'"><img onerror="this.setProperty(\'src\',\'images/blank.png\')" class="group-title-favicon" alt="Favicon" src="'+e[G.counter].favicon+'"><span onclick="toggleGroup(\''+e[G.counter].host+'\')" class="group-title-host">'+e[G.counter].host.replace("www.","")+"</span>"}).inject(o);new Element("div",{"class":"group-holder",rel:e[G.counter].host,styles:{display:"none"}}).inject(o);if(y=="#fff"){y="#f1f1f1"}else{y="#fff"}if(A=="white"){A="grey"}else{A="white"}}if(g=="search"&&(n=="all"||n=="recent")){e[G.counter].time="- - : - -"}var F;F='<div class="item">';F+='<span class="checkbox"><label><input class="chkbx" type="checkbox" onclick="selectHistoryItem(this, \'single\')" value="'+e[G.counter].url+'" name="check"></label>&nbsp;</span>';F+='<span class="bookmark">&nbsp;</span>';F+='<span class="time">'+e[G.counter].time+"</span>";F+='<a style="padding-left:0;" target="_blank" class="link" href="'+e[G.counter].url+'">';F+='<span class="title" title="'+e[G.counter].url+'" rel="'+returnLang("visits")+": "+e[G.counter].visits+" | "+e[G.counter].time+" "+e[G.counter].date+'">'+e[G.counter].title+"</span>";F+="</a>";F+="</div>";new Element("div",{rel:$(o).getElement('div.item-holder[title="'+e[G.counter].host+'"]').get("rel"),"class":"item-holder",styles:{"background-color":$(o).getElement('div.item-holder[title="'+e[G.counter].host+'"]').getStyle("background-color")}}).set("html",F+'<div class="clearitem" style="clear:both;"></div>').inject($(o).getElement('div[rel="'+e[G.counter].host+'"]'))}}G.counter++}).periodical(5,D)}else{if(c=="no"){prh=(function(){var G=this;if(G.counter==e.length){clearInterval(prh)}else{if(e[G.counter]!==undefined){if(g=="search"&&(n=="all"||n=="recent")){e[G.counter].time="- - : - -"}var F;F='<div class="item">';F+='<span class="checkbox"><label><input class="chkbx" type="checkbox" onclick="selectHistoryItem(this, \'single\')" value="'+e[G.counter].url+'" name="check"></label>&nbsp;</span>';F+='<span class="bookmark">&nbsp;</span>';F+='<span class="time">'+e[G.counter].time+"</span>";F+='<a target="_blank" class="link" href="'+e[G.counter].url+'">';F+='<img onerror="this.setProperty(\'src\',\'images/blank.png\')" class="favicon" alt="Favicon" src="'+e[G.counter].favicon+'">';F+='<span class="title" title="'+e[G.counter].url+'" rel="'+returnLang("visits")+": "+e[G.counter].visits+" | "+e[G.counter].time+" "+e[G.counter].date+'">'+e[G.counter].title+"</span>";F+="</a>";F+="</div>";new Element("div",{rel:A,"class":"item-holder",styles:{"background-color":y}}).set("html",F+'<div class="clearitem" style="clear:both;"></div>').inject(o);if(y=="#fff"){y="#f1f1f1"}else{y="#fff"}if(A=="white"){A="grey"}else{A="white"}}}G.counter++}).periodical(5,D)}}isBookmarked("#rh-views .item .link");$(document.body).getElement("#rh-bar-uione input").set("checked",false);selectedItem=undefined;new Tips(".title",{className:"tip-holder"});if($$("#"+o+" div.group-title").length>0){toggleGroup($$("#"+o+" div.group-title")[0].get("title"))}}else{$(o).set("html",'<div class="no-results"><span>'+returnLang("noResults")+"</span></div>")}}else{$(o).set("html",'<div class="no-results"><span>'+returnLang("noResults")+"</span></div>")}})}function toggleGroup(e){if(getActiveHistory()=="history"){var c="rh-views-insert"}else{if(getActiveHistory()=="search"){var c="rh-views-search-insert"}}var a=$(c).getElement('a[rel="'+e+'"]');var g=$(c).getElement('div[rel="'+e+'"]');var b=g.getStyle("display");if(b=="block"){g.setStyle("display","none");a.setStyle("background-position","left center")}else{g.setStyle("display","block");a.setStyle("background-position","right center")}}function getActiveHistory(){if($("rh-views-insert").getStyle("display")=="block"){return"history"}else{if($("rh-views-search-insert").getStyle("display")=="block"){return"search"}}}function getMoreItems(b){if(getActiveHistory()=="history"){var a="#rh-views-insert"}else{if(getActiveHistory()=="search"){var a="#rh-views-search-insert"}}var c=b.get("value");if(b.get("checked")==false){$$(a+" .chkbx").each(function(g){var e=new URI(g.get("value")).get("host");if(c==e){g.set("checked",false);if(g.getParent("div.item-holder").get("rel")=="white"){g.getParent("div.item-holder").setStyle("background-color","#fff");b.getParent("div.group-title").setStyle("background-color","#fff")}else{g.getParent("div.item-holder").setStyle("background-color","#f1f1f1");b.getParent("div.group-title").setStyle("background-color","#f1f1f1")}}})}else{if(b.get("checked")==true){$$(a+" .chkbx").each(function(g){var e=new URI(g.get("value")).get("host");if(c==e){g.set("checked",true);b.getParent("div.group-title").setStyle("background-color",itemSelectedColor);selectHistoryItem(g,"single")}})}}if($$(a+" .chkbx").length==$$(a+" .chkbx:checked").length){$("master-check-all").set("checked",true);$("master-check-all").set("value","true")}else{$("master-check-all").set("checked",false);$("master-check-all").set("value","false")}}function resetColor(){if(getActiveHistory()=="history"){var a="#rh-views-insert"}else{if(getActiveHistory()=="search"){var a="#rh-views-search-insert"}}$$(a+" .item-holder").each(function(b){if(b.get("rel")=="grey"){b.setStyle("background-color","#f1f1f1")}else{if(b.get("rel")=="white"){b.setStyle("background-color","#fff")}}if(b.getElement("input.chkbx").get("checked")==true){b.setStyle("background-color",itemSelectedColor)}})}function selectHistoryItem(h,b){var a=localStorage["rh-group"];if(getActiveHistory()=="history"){var e="#rh-views-insert"}else{if(getActiveHistory()=="search"){var e="#rh-views-search-insert"}}if(b=="single"){if(h.get("checked")==true){if(shiftState=="true"&&selectedItem!==undefined){var c="false";var g=$$(e+" .chkbx");for(i=0;i<g.length;i++){if(g[i]==h||g[i]==selectedItem){if(c=="false"){c="true"}else{if(c=="true"){c="false"}}}if(c=="true"&&g[i]!==h&&g[i]!==selectedItem){if(g[i].get("checked")==true){g[i].set("checked",false);if(g[i].getParent("div.item-holder").get("rel")=="white"){g[i].getParent("div.item-holder").setStyle("background-color","#fff")}else{g[i].getParent("div.item-holder").setStyle("background-color","#f1f1f1")}}else{if(g[i].get("checked")==false){g[i].set("checked",true);g[i].getParent("div.item-holder").setStyle("background-color",itemSelectedColor)}}}}}selectedItem=h;h.getParent("div.item-holder").setStyle("background-color",itemSelectedColor)}else{if(h.get("checked")==false){selectedItem=undefined;var k=h.get("value");$$(e+" .chkbx").each(function(l){if(l.get("value")==k){if(l.getParent("div.item-holder").get("rel")=="white"){l.getParent("div.item-holder").setStyle("background-color","#fff")}else{l.getParent("div.item-holder").setStyle("background-color","#f1f1f1")}}})}}if($$(e+" .chkbx").length==$$(e+" .chkbx:checked").length){$("master-check-all").set("checked",true);$("master-check-all").set("value","true")}else{$("master-check-all").set("checked",false);$("master-check-all").set("value","false")}if(a=="yes"){var j=h.getParent(".group-holder");if(j.getElements(".chkbx").length==j.getElements(".chkbx:checked").length){$$(e+' div[title="'+j.get("rel")+'"]')[0].setStyle("background-color",itemSelectedColor);$$(e+' div[title="'+j.get("rel")+'"]')[0].getElement(".group-title-checkbox").set("checked",true)}else{if($$(e+' div[title="'+j.get("rel")+'"]')[0].get("rel")=="grey"){$$(e+' div[title="'+j.get("rel")+'"]')[0].setStyle("background-color","#f1f1f1");$$(e+' div[title="'+j.get("rel")+'"]')[0].getElement(".group-title-checkbox").set("checked",false)}else{if($$(e+' div[title="'+j.get("rel")+'"]')[0].get("rel")=="white"){$$(e+' div[title="'+j.get("rel")+'"]')[0].setStyle("background-color","#fff");$$(e+' div[title="'+j.get("rel")+'"]')[0].getElement(".group-title-checkbox").set("checked",false)}}}}}else{if(b=="all"){if(h.get("value")=="false"){$$(e+" .chkbx").each(function(l){l.set("checked",true);l.getParent("div.item-holder").setStyle("background-color",itemSelectedColor)});if(a=="yes"){$$(e+" .group-title").each(function(l){l.getElement("input").set("checked",true);l.setStyle("background-color",itemSelectedColor)})}h.set("value","true")}else{$$(e+" .chkbx").each(function(l){l.set("checked",false);if(l.getParent("div.item-holder").get("rel")=="white"){l.getParent("div.item-holder").setStyle("background-color","#fff")}else{l.getParent("div.item-holder").setStyle("background-color","#f1f1f1")}});if(a=="yes"){$$(e+" .group-title").each(function(l){l.getElement("input").set("checked",false);if(l.get("rel")=="white"){l.setStyle("background-color","#fff")}else{l.setStyle("background-color","#f1f1f1")}})}h.set("value","false")}}}}function deleteHistoryItem(b){if(b=="selected"){var a=localStorage["rh-group"];if(getActiveHistory()=="history"){var c="#rh-views-insert"}else{if(getActiveHistory()=="search"){var c="#rh-views-search-insert"}}if($$(c+" .checkbox input:checked").length>0){$$("title").set("text","Deleting...");alertUserHistory(true);$$(c+" .checkbox input:checked").each(function(l){l.getParent("div.item-holder").destroy();chrome.history.deleteUrl({url:l.get("value")})});chrome.history.search({text:"",maxResults:1,startTime:(new Date()).getTime()-(1*24*3600*1000),endTime:(new Date()).getTime()},function(l){if(a=="yes"){$$(c+" .group-holder").each(function(n){if(n.getChildren("div.item-holder").length==0){$$(c+' .group-title[title="'+n.get("rel")+'"]').destroy();n.destroy()}})}$$("title").set("text","History | Recent History");alertUserHistory(true)})}}else{if(b=="range"){var j=localStorage["rh-date"];var e=$("delete-range-one").get("value").split("/");var k=$("delete-range-two").get("value").split("/");if(j=="dd/mm/yyyy"){var h=new Date(e[2],(e[1]-1),e[0],23,59,59,999).getTime()-86400000;var g=new Date(k[2],(k[1]-1),k[0],23,59,59,999).getTime()}else{if(j=="mm/dd/yyyy"){var h=new Date(e[2],(e[0]-1),e[1],23,59,59,999).getTime()-86400000;var g=new Date(k[2],(k[0]-1),k[1],23,59,59,999).getTime()}else{if(j=="yyyy/mm/dd"){var h=new Date(e[0],(e[1]-1),e[2],23,59,59,999).getTime()-86400000;var g=new Date(k[0],(k[1]-1),k[2],23,59,59,999).getTime()}}}if(h<g){$$("title").set("text","Deleting...");alertUserHistory(true);chrome.history.deleteRange({startTime:h,endTime:g},function(){calendar("yes","");history("yes","");$$("title").set("text","History | Recent History");alertUserHistory(true)})}}}};